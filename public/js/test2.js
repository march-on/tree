var test = {
    "result": [
        {
            "id": "1726",
            "pid": "null",
            "type": "project",
            "name": "项目一",
            "level": "1",
            "owner": "张胜军",
            "job": "null",
            "area": "null",
            "children": [
                {
                    "id": "1",
                    "pid": "1726",
                    "type": "project",
                    "name": "clodtest",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "11",
                            "pid": "1",
                            "type": "employee",
                            "name": "王晓媛",
                            "level": "null",
                            "owner": "null",
                            "job": "web",
                            "area": "成都",
                            "children": []
                        },
                        {
                            "id": "12",
                            "pid": "1",
                            "type": "employee",
                            "name": "王鑫",
                            "level": "null",
                            "owner": "null",
                            "job": "测试",
                            "area": "西安",
                            "children": []
                        },
                    ]
                },
                {
                    "id": "2",
                    "pid": "1726",
                    "type": "project",
                    "name": "API",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "22",
                            "pid": "2",
                            "type": "employee",
                            "name": "李增益",
                            "level": "null",
                            "owner": "null",
                            "job": "web",
                            "area": "北京",
                            "children": []
                        },
                        {
                            "id": "23",
                            "pid": "2",
                            "type": "employee",
                            "name": "杜红",
                            "level": "null",
                            "owner": "null",
                            "job": "java",
                            "area": "深圳",
                            "children": []
                        },
                        {
                            "id": "24",
                            "pid": "2",
                            "type": "employee",
                            "name": "银鑫",
                            "level": "null",
                            "owner": "null",
                            "job": "java",
                            "area": "西安",
                            "children": []
                        }
                    ]
                },
                {
                    "id": "3",
                    "pid": "1726",
                    "type": "project",
                    "name": "UI",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "33",
                            "pid": "3",
                            "type": "employee",
                            "name": "杨锁",
                            "level": "null",
                            "owner": "null",
                            "job": "web",
                            "area": "北京",
                            "children": []
                        },
                        {
                            "id": "34",
                            "pid": "3",
                            "type": "employee",
                            "name": "张三",
                            "level": "null",
                            "owner": "null",
                            "job": "测试",
                            "area": "成都",
                            "children": []
                        },
                    ]
                }
            ],
        },
        {
            "id": "1727",
            "pid": "null",
            "type": "project",
            "name": "项目二",
            "level": "1",
            "owner": "付顺",
            "job": "null",
            "area": "null",
            "children": [
                {
                    "id": "01",
                    "pid": "1727",
                    "type": "project",
                    "name": "clodtest二",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "011",
                            "pid": "01",
                            "type": "project",
                            "name": "NUV运维",
                            "level": "3",
                            "owner": "null",
                            "job": "null",
                            "area": "null",
                            "children": [
                                {
                                    "id": "022",
                                    "pid": "011",
                                    "type": "employee",
                                    "name": "李增益",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "web",
                                    "area": "北京",
                                    "children": []
                                },
                                {
                                    "id": "023",
                                    "pid": "011",
                                    "type": "employee",
                                    "name": "李益",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "java",
                                    "area": "深圳",
                                    "children": []
                                }
                            ]
                        },
                        {
                            "id": "011",
                            "pid": "01",
                            "type": "project",
                            "name": "测试平台",
                            "level": "3",
                            "owner": "null",
                            "job": "null",
                            "area": "null",
                            "children": [
                                {
                                    "id": "022",
                                    "pid": "011",
                                    "type": "employee",
                                    "name": "李四",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "web",
                                    "area": "北京",
                                    "children": []
                                },
                                {
                                    "id": "023",
                                    "pid": "011",
                                    "type": "employee",
                                    "name": "李益",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "java",
                                    "area": "西安",
                                    "children": []
                                }
                            ]
                        }

                    ]
                },
                {
                    "id": "02",
                    "pid": "1727",
                    "type": "project",
                    "name": "API二",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "012",
                            "pid": "02",
                            "type": "project",
                            "name": "NUV平台",
                            "level": "3",
                            "owner": "null",
                            "job": "null",
                            "area": "null",
                            "children": [
                                {
                                    "id": "023",
                                    "pid": "012",
                                    "type": "employee",
                                    "name": "王磊",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "web",
                                    "area": "北京",
                                    "children": []
                                },
                                {
                                    "id": "024",
                                    "pid": "012",
                                    "type": "employee",
                                    "name": "李益",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "web",
                                    "area": "西安",
                                    "children": []
                                }
                            ]
                        },

                    ]
                }


            ],
        }

    ],
    "error": "",
    "status": "success"
}
$(function(){
    
    let treeData=[];
    let areas=[];
    $("#tabs").delegate("li","click",function(e){

        let id="1726";
        refreshTree();
    })
  

})
function refreshTree(id){
    console.log(test)
    if(test.result=="success"){
        let arr_nest=test.result;
        let currentData=arr_nest.filter(function(item){
            return item.id==id;
        })
        if(currentData.length==0){
            console.log("no current project data");
            return;
        }
        treeData.push(formartData(currentData[0]));
        renderTree();

    }

}

function formartData(nodeData){
    let result={};
    result.name=nodeData.name;
    result.id=nodeData.id;
    result.pId=nodeData.pid||"0";
    result.area=nodeData.area;
    if(nodeData.children&&nodeData.children.length){
        result.isparent=true;
        result.children=[];
        if(nodeData.children[0].area){
            result.isEmployee=true;
        }
        nodeData.children.map(function(item){
            result.children.push(formartData(item));

        })
    }else if(nodeData.area&&!nodeData.children.length){
        let area=nodeData.area;
        if(areas.indexOf(area==-1)){
            areas.push(area);

        }

    }return result;

}

function renderTree(){
    let $target=$("#treeBox");
    getAreaHtml();
    $target.append(getTreeHtml(treeData,false));

}

function getAreaHtml(){
    
    let $target=$(".areas");
    $target.empty;
    areas.map(function(item){
        let $li=$("<li></li>");
        $li.addClass("title").text(item);
        $target.append($li);
    })
}
function getTreeHtml(data,isEmployee){
    let html=$("<ul></ul>");
    if(isEmployee){
        let result=[];
        areas.map(function(item){
            let $ul=$("<ul class='employee'></ul>");
            data.filter(function(employee){
                return employee.area==item;

            }).map(function(currEmployee){
                let $li=$("<li></li>");
                $li.text(currEmployee.name);
                $ul.append($li);
 
            })
            result.push($ul);
        })
        return result;
    }
    data.map(function(item){
        let $li=$("<li></li>");
        $li.addClass("title").text(item.name);
        if(item.children){
            $li.append(getTreeHtml(item.children,item.isEmployee))
        }
        html.append($li);
    })
    return html;
}