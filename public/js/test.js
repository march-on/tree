var test = {
    "result": [
        {
            "id": "1726",
            "pid": "null",
            "type": "project",
            "name": "项目一",
            "level": "1",
            "owner": "张胜军",
            "job": "null",
            "area": "null",
            "children": [
                {
                    "id": "1",
                    "pid": "1726",
                    "type": "project",
                    "name": "clodtest",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "11",
                            "pid": "1",
                            "type": "employee",
                            "name": "王晓媛",
                            "level": "null",
                            "owner": "null",
                            "job": "web",
                            "area": "成都",
                            "children": []
                        },
                        {
                            "id": "12",
                            "pid": "1",
                            "type": "employee",
                            "name": "王鑫",
                            "level": "null",
                            "owner": "null",
                            "job": "测试",
                            "area": "西安",
                            "children": []
                        },
                    ]
                },
                {
                    "id": "2",
                    "pid": "1726",
                    "type": "project",
                    "name": "API",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "22",
                            "pid": "2",
                            "type": "employee",
                            "name": "李增益",
                            "level": "null",
                            "owner": "null",
                            "job": "web",
                            "area": "北京",
                            "children": []
                        },
                        {
                            "id": "23",
                            "pid": "2",
                            "type": "employee",
                            "name": "杜红",
                            "level": "null",
                            "owner": "null",
                            "job": "java",
                            "area": "深圳",
                            "children": []
                        },
                        {
                            "id": "24",
                            "pid": "2",
                            "type": "employee",
                            "name": "银鑫",
                            "level": "null",
                            "owner": "null",
                            "job": "java",
                            "area": "西安",
                            "children": []
                        }
                    ]
                },
                {
                    "id": "3",
                    "pid": "1726",
                    "type": "project",
                    "name": "UI",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "33",
                            "pid": "3",
                            "type": "employee",
                            "name": "杨锁",
                            "level": "null",
                            "owner": "null",
                            "job": "web",
                            "area": "北京",
                            "children": []
                        },
                        {
                            "id": "34",
                            "pid": "3",
                            "type": "employee",
                            "name": "张三",
                            "level": "null",
                            "owner": "null",
                            "job": "测试",
                            "area": "成都",
                            "children": []
                        },
                    ]
                }
            ],
        },
        {
            "id": "1727",
            "pid": "null",
            "type": "project",
            "name": "项目二",
            "level": "1",
            "owner": "付顺",
            "job": "null",
            "area": "null",
            "children": [
                {
                    "id": "01",
                    "pid": "1727",
                    "type": "project",
                    "name": "clodtest二",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "011",
                            "pid": "01",
                            "type": "project",
                            "name": "NUV运维",
                            "level": "3",
                            "owner": "null",
                            "job": "null",
                            "area": "null",
                            "children": [
                                {
                                    "id": "022",
                                    "pid": "011",
                                    "type": "employee",
                                    "name": "李增益",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "web",
                                    "area": "北京",
                                    "children": []
                                },
                                {
                                    "id": "023",
                                    "pid": "011",
                                    "type": "employee",
                                    "name": "李益3333",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "java",
                                    "area": "深圳",
                                    "children": []
                                }
                            ]
                        },
                        {
                            "id": "011",
                            "pid": "01",
                            "type": "project",
                            "name": "测试平台",
                            "level": "3",
                            "owner": "null",
                            "job": "null",
                            "area": "null",
                            "children": [
                                {
                                    "id": "022",
                                    "pid": "011",
                                    "type": "employee",
                                    "name": "李四",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "web",
                                    "area": "北京",
                                    "children": []
                                },
                                {
                                    "id": "023",
                                    "pid": "011",
                                    "type": "employee",
                                    "name": "李益222",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "java",
                                    "area": "西安",
                                    "children": []
                                }
                            ]
                        }

                    ]
                },
                {
                    "id": "02",
                    "pid": "1727",
                    "type": "project",
                    "name": "API二",
                    "level": "2",
                    "owner": "null",
                    "job": "null",
                    "area": "null",
                    "children": [
                        {
                            "id": "012",
                            "pid": "02",
                            "type": "project",
                            "name": "NUV平台",
                            "level": "3",
                            "owner": "null",
                            "job": "null",
                            "area": "null",
                            "children": [
                                {
                                    "id": "023",
                                    "pid": "012",
                                    "type": "employee",
                                    "name": "王磊",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "web",
                                    "area": "北京",
                                    "children": []
                                },
                                {
                                    "id": "024",
                                    "pid": "012",
                                    "type": "employee",
                                    "name": "李益",
                                    "level": "null",
                                    "owner": "null",
                                    "job": "web",
                                    "area": "西安",
                                    "children": []
                                }
                            ]
                        },

                    ]
                }


            ],
        }

    ],
    "error": "",
    "status": "success"
}
let str = "";
let areas = [];//区域
let oneLevel = [];//一级标题
let twoLevel = [];//二级标题
let threeLevel = [];//三级标题
let allLevel = [];//所有的标题
let peoples = [];//所有的人
$(function () {
   
    function TraversalObject(obj) {
      
        if (obj.type == "project") {
            if (obj.level == "1") {
                // str += `<ul><li>${obj.name}(${obj.owner})</li></ul>`
                oneLevel.push(obj.name)
            }
            else if (obj.level == "2") {
                // console.log(obj.level,obj.name)        
                //str += `<ul class="treeBox_ul"><li>${obj.name}</li></ul>`
                twoLevel.push(obj.name)
            }
            else if (obj.level == "3") {
                threeLevel.push(obj.name)
                // console.log(obj.level,obj.name)
                // let str2="";
                // str2+=`<li>${obj.name}</li>`
                // str += `<ul class="treeBox_ul clear">${str2}</ul>`         
            }
            //$(`#treeBox`).html(str)
        }
        else if (obj.type == "employee") {
            areas.push(obj.area)
        }

        for (var a in obj) {

            if (typeof (obj[a]) == "object") {
                peoples.push(obj)
                for (let j = 0; j < obj[a].length; j++) {
                    TraversalObject(obj[a][j]); //递归遍历        
                }

            }




        }
        allLevel = [];
        allLevel.push(oneLevel, twoLevel, threeLevel)

        render(allLevel, peoples)
    }

    function render(allLevel, peoples) {      //渲染页面
        let uniqueAreas = unique(areas);//去重以后的数组
        let lastLevel;//最后的标题
        let str = "";
        let str2 = "";//清空
        let str3 = "";
        let str4 = "";
        let ul = "";
        for (let i = 0; i < allLevel.length; i++) {
            let str = "";//清空
            let str2 = "";
            str += `<ul>`
            $(`#treeBox`).html(str);
            for (let j = 0; j < allLevel[i].length; j++) {
                str2 += `<li>${allLevel[i][j]}</li>`
                // console.log(str2)          
            }
            str3 += str + str2 + `</ul>`;
            $(`#treeBox`).html(str3);
        }



        if (allLevel[allLevel.length - 1] != "") {
            lastLevel = allLevel[allLevel.length - 1];
        } else {
            lastLevel = allLevel[allLevel.length - 2];
        }
        for (let i = 0; i < lastLevel.length; i++) {    //渲染放人的DIV           
            let newUl= $("<ul></ul>")
            for (let j = 0; j < uniqueAreas.length; j++) {
                newUl.append($("<li></li>").addClass(`${lastLevel[j]} ${uniqueAreas[j]}`))
            }    
             
            $(`#peoples`).html(newUl);
        }

        for (let i = 0; i < peoples.length; i++) {
            for (let j = 0; j < lastLevel.length; j++) {
                if (peoples[i].name == lastLevel[j]) {
                    for (let k = 0; k < peoples[i].children.length; k++) {
                        for (let l = 0; l < uniqueAreas.length;l++) {
                            if (peoples[i].children[k].area == uniqueAreas[l]) {
                             //   console.log(peoples[i].children[k].name)
                               $(`.${lastLevel[j]}.${uniqueAreas[l]}`).append(`${peoples[i].children[k].name}`)
                            }
                        }
                    }
                }
            }}


            }

            function unique(arr) {      //区域去重
                var newArr = [arr[0]];
                for (var i = 1; i < arr.length; i++) {
                    if (newArr.indexOf(arr[i]) == -1) {
                        newArr.push(arr[i]);
                    }
                }
                return newArr;
            }
            unique(areas);


            for (let i of test.result) {
                $("#tabs").append(`<li id="${i.id}">${i.name}</li>`);//导航
            }
            $("#tabs").delegate('li', 'click', function (e) {
                oneLevel = [];//一级标题
                twoLevel = [];//二级标题
                threeLevel = [];//三级标题
                peoples = [];//所有的人

                areas = [];
                str = "";
                //console.log(e.target.id)
                let chooseBbj = {};
                for (let i = 0; i < test.result.length; i++) {
                    console.log(e.target.id)
                    if (e.target.id == test.result[i].id) {
                        chooseBbj = test.result[i];
                        TraversalObject(chooseBbj)
                        return;
                    }
                }

               
            })




        })